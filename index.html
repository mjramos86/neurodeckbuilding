<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spoon Theory - Le Jeu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        button {
            cursor: pointer;
        }
        button:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen">
    <div id="app"></div>

    <script>
        // √âtat du jeu
        let gameState = {
            phase: 'intro',
            spoons: 12,
            maxSpoons: 12,
            neuralResources: 0,
            day: 1,
            deck: [],
            hand: [],
            currentSituation: null,
            situationIndex: 0,
            message: '',
            profile: null,
            socialClass: null,
            selectedProfile: null,
            selectedClass: null
        };

        // Profils
        const profiles = {
            tdah: {
                name: "TDAH",
                description: "Hyperfocus puissant mais transitions difficiles",
                startingSpoons: 10
            },
            autisme: {
                name: "Autisme",
                description: "Routines efficaces, impr√©vus co√ªteux",
                startingSpoons: 12
            },
            migraine: {
                name: "Migraine Chronique",
                description: "Sensible aux d√©clencheurs sensoriels",
                startingSpoons: 8
            }
        };

        // Classes sociales
        const socialClasses = {
            privilegie: {
                name: "Famille Ais√©e",
                description: "Acc√®s rapide aux soins, ressources abondantes",
                startingCards: ['evaluation_privee', 'therapie', 'amenagements', 'pause_cafe']
            },
            moyenne: {
                name: "Famille Moyenne",
                description: "Quelques ressources, attentes importantes",
                startingCards: ['liste_attente', 'recherche_google', 'routine_matinale', 'pause_cafe']
            },
            precaire: {
                name: "Situation Pr√©caire",
                description: "Ressources limit√©es, syst√®me D obligatoire",
                startingCards: ['minimiser', 'travailler_malade', 'systeme_d', 'respiration']
            }
        };

        // Cartes
        const allCards = {
            evaluation_privee: { name: "√âvaluation Priv√©e", cost: 2, effect: "D√©bloque des strat√©gies m√©dicales (+5 ressources)", type: "action", reward: 5 },
            therapie: { name: "S√©ance de Th√©rapie", cost: 3, effect: "Restaure 2 cuill√®res, +3 ressources", type: "soin", restore: 2, reward: 3 },
            amenagements: { name: "Am√©nagements Workplace", cost: 1, effect: "R√©duit le co√ªt des situations professionnelles", type: "buff" },
            liste_attente: { name: "Liste d'Attente", cost: 0, effect: "Patience... Un jour. +1 ressource", type: "action", reward: 1 },
            recherche_google: { name: "Recherche Google 3h", cost: 4, effect: "Informations fragment√©es (+2 ressources)", type: "action", reward: 2 },
            routine_matinale: { name: "Routine Matinale", cost: 1, effect: "R√©duit le co√ªt de la prochaine action", type: "buff" },
            minimiser: { name: "Minimiser les Sympt√¥mes", cost: 2, effect: "Masque la r√©alit√©. Perd 1 cuill√®re plus tard", type: "action" },
            travailler_malade: { name: "Travailler Malade", cost: 5, effect: "Survie √©conomique au prix de ta sant√©", type: "action" },
            systeme_d: { name: "Syst√®me D", cost: 1, effect: "Improvisation cr√©ative (+1 ressource)", type: "action", reward: 1 },
            pause_cafe: { name: "Pause Caf√©", cost: 1, effect: "Restaure 1 cuill√®re", type: "soin", restore: 1 },
            respiration: { name: "Exercice de Respiration", cost: 0, effect: "Calme momentan√©. Restaure 1 cuill√®re", type: "soin", restore: 1 },
            dire_non: { name: "Dire Non", cost: 2, effect: "Pr√©serve 3 cuill√®res en refusant", type: "defense" },
            ecouteurs: { name: "√âcouteurs Anti-Bruit", cost: 0, effect: "R√©duit le co√ªt des situations bruyantes", type: "buff" }
        };

        // Situations
        const situations = [
            {
                title: "R√©veil Matinal",
                description: "Ton alarme sonne. Une nouvelle journ√©e commence.",
                icon: "‚òï",
                choices: [
                    { text: "Routine habituelle", cost: 2, reward: 1 },
                    { text: "Snooze 5 fois", cost: 1, reward: 0 }
                ]
            },
            {
                title: "Transport en Commun",
                description: "Le m√©tro est bond√© et bruyant.",
                icon: "üöá",
                choices: [
                    { text: "Endurer le trajet", cost: 3, reward: 1 },
                    { text: "Utiliser √©couteurs", cost: 1, reward: 2, requiresCard: "ecouteurs" }
                ]
            },
            {
                title: "R√©union de Travail",
                description: "R√©union improvis√©e de 2h dans une salle sans fen√™tres.",
                icon: "üíº",
                choices: [
                    { text: "Participer activement", cost: 5, reward: 3 },
                    { text: "Mode survie minimal", cost: 3, reward: 1 }
                ]
            },
            {
                title: "Interaction Sociale",
                description: "Coll√®gue insiste pour discuter de ta vie personnelle.",
                icon: "üë•",
                choices: [
                    { text: "Masquer et socialiser", cost: 4, reward: 1 },
                    { text: "Excuses polies", cost: 1, reward: 1, requiresCard: "dire_non" }
                ]
            },
            {
                title: "√âpicerie Bond√©e",
                description: "Tu dois faire les courses. C'est samedi apr√®s-midi.",
                icon: "üõí",
                choices: [
                    { text: "Affronter la foule", cost: 4, reward: 2 },
                    { text: "Liste rapide et fuite", cost: 2, reward: 1 }
                ]
            }
        ];

        // Fonctions du jeu
        function selectProfile(profileKey) {
            gameState.selectedProfile = profileKey;
            render();
        }

        function selectClass(classKey) {
            gameState.selectedClass = classKey;
            render();
        }

        function startGame() {
            const profile = profiles[gameState.selectedProfile];
            const socialClass = socialClasses[gameState.selectedClass];
            
            gameState.profile = profile;
            gameState.socialClass = socialClass;
            gameState.spoons = profile.startingSpoons;
            gameState.maxSpoons = profile.startingSpoons;
            
            gameState.deck = socialClass.startingCards.map(cardId => ({
                id: cardId,
                ...allCards[cardId]
            }));
            
            drawHand();
            gameState.phase = 'day';
            nextSituation();
            render();
        }

        function drawHand() {
            const shuffled = [...gameState.deck].sort(() => Math.random() - 0.5);
            gameState.hand = shuffled.slice(0, 4);
        }

        function nextSituation() {
            if (gameState.situationIndex < situations.length) {
                gameState.currentSituation = situations[gameState.situationIndex];
                gameState.situationIndex++;
            } else {
                gameState.phase = 'rest';
                gameState.message = 'Journ√©e termin√©e. Phase de repos.';
            }
        }

        function handleChoice(choiceIndex) {
            const choice = gameState.currentSituation.choices[choiceIndex];
            
            if (choice.requiresCard && !gameState.hand.find(c => c.id === choice.requiresCard)) {
                gameState.message = `Vous avez besoin de la carte "${allCards[choice.requiresCard].name}"`;
                render();
                return;
            }

            if (gameState.spoons < choice.cost) {
                gameState.message = 'Pas assez de cuill√®res! Burnout...';
                gameState.spoons = 0;
                render();
                setTimeout(() => {
                    gameState.phase = 'gameOver';
                    render();
                }, 1500);
                return;
            }

            gameState.spoons = Math.max(0, gameState.spoons - choice.cost);
            gameState.neuralResources += (choice.reward || 0);
            gameState.message = `-${choice.cost} cuill√®res, +${choice.reward || 0} ressources`;
            
            render();
            setTimeout(() => {
                gameState.message = '';
                nextSituation();
                render();
            }, 1000);
        }

        function playCard(cardIndex) {
            const card = gameState.hand[cardIndex];
            
            if (gameState.spoons < card.cost) {
                gameState.message = 'Pas assez de cuill√®res pour cette carte';
                render();
                setTimeout(() => {
                    gameState.message = '';
                    render();
                }, 2000);
                return;
            }

            gameState.spoons = Math.max(0, gameState.spoons - card.cost);
            
            if (card.restore) {
                gameState.spoons = Math.min(gameState.maxSpoons, gameState.spoons + card.restore);
                gameState.message = `${card.name}: restaur√© ${card.restore} cuill√®re(s)`;
            } else {
                gameState.message = `${card.name} jou√©: ${card.effect}`;
            }
            
            if (card.reward) {
                gameState.neuralResources += card.reward;
            }

            gameState.hand = gameState.hand.filter((c, i) => i !== cardIndex);
            
            render();
            setTimeout(() => {
                gameState.message = '';
                render();
            }, 2000);
        }

        function restPhase() {
            const restoredSpoons = Math.floor(gameState.maxSpoons * 0.7);
            gameState.spoons = restoredSpoons;
            gameState.day++;
            gameState.situationIndex = 0;
            drawHand();
            gameState.phase = 'day';
            gameState.message = `Jour ${gameState.day}: ${restoredSpoons} cuill√®res restaur√©es`;
            render();
            setTimeout(() => {
                gameState.message = '';
                nextSituation();
                render();
            }, 2000);
        }

        function upgradeSpoons() {
            if (gameState.neuralResources >= 3) {
                gameState.neuralResources -= 3;
                gameState.maxSpoons++;
                gameState.message = 'Cuill√®res maximales augment√©es!';
                render();
                setTimeout(() => {
                    gameState.message = '';
                    render();
                }, 2000);
            } else {
                gameState.message = 'Pas assez de ressources neurales (besoin: 3)';
                render();
                setTimeout(() => {
                    gameState.message = '';
                    render();
                }, 2000);
            }
        }

        // Rendu de l'interface
        function render() {
            const app = document.getElementById('app');
            
            if (gameState.phase === 'intro') {
                app.innerHTML = renderIntro();
                attachIntroEventListeners();
            } else if (gameState.phase === 'day') {
                app.innerHTML = renderDay();
                attachDayEventListeners();
            } else if (gameState.phase === 'rest') {
                app.innerHTML = renderRest();
                attachRestEventListeners();
            } else if (gameState.phase === 'gameOver') {
                app.innerHTML = renderGameOver();
                attachGameOverEventListeners();
            }
        }

        function attachIntroEventListeners() {
            // Profile buttons
            document.querySelectorAll('[data-profile]').forEach(btn => {
                btn.addEventListener('click', () => selectProfile(btn.dataset.profile));
            });
            
            // Class buttons
            document.querySelectorAll('[data-class]').forEach(btn => {
                btn.addEventListener('click', () => selectClass(btn.dataset.class));
            });
            
            // Start button
            const startBtn = document.getElementById('startButton');
            if (startBtn) {
                startBtn.addEventListener('click', startGame);
            }
        }

        function attachDayEventListeners() {
            // Choice buttons
            document.querySelectorAll('[data-choice]').forEach(btn => {
                btn.addEventListener('click', () => handleChoice(parseInt(btn.dataset.choice)));
            });
            
            // Card buttons
            document.querySelectorAll('[data-card]').forEach(btn => {
                btn.addEventListener('click', () => playCard(parseInt(btn.dataset.card)));
            });
        }

        function attachRestEventListeners() {
            const upgradeBtn = document.getElementById('upgradeSpoons');
            if (upgradeBtn) {
                upgradeBtn.addEventListener('click', upgradeSpoons);
            }
            
            const nextDayBtn = document.getElementById('nextDay');
            if (nextDayBtn) {
                nextDayBtn.addEventListener('click', restPhase);
            }
        }

        function attachGameOverEventListeners() {
            const restartBtn = document.getElementById('restart');
            if (restartBtn) {
                restartBtn.addEventListener('click', () => location.reload());
            }
        }

        function renderIntro() {
            return `
                <div class="max-w-4xl mx-auto p-8">
                    <h1 class="text-5xl font-bold text-indigo-900 mb-4 text-center fade-in">
                        Spoon Theory
                    </h1>
                    <p class="text-xl text-indigo-700 mb-8 text-center italic">
                        Votre cerveau est diff√©rent. Le monde devrait l'√™tre aussi.
                    </p>

                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6 fade-in">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Choisissez votre profil</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${Object.entries(profiles).map(([key, prof]) => `
                                <button data-profile="${key}" 
                                    class="p-4 rounded-lg border-2 transition-all card-hover ${
                                        gameState.selectedProfile === key 
                                            ? 'border-indigo-600 bg-indigo-50' 
                                            : 'border-gray-300 hover:border-indigo-400'
                                    }">
                                    <h3 class="font-bold text-lg mb-2">${prof.name}</h3>
                                    <p class="text-sm text-gray-600">${prof.description}</p>
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    <div class="bg-white rounded-lg shadow-lg p-6 mb-6 fade-in">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">Choisissez votre contexte social</h2>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            ${Object.entries(socialClasses).map(([key, sClass]) => `
                                <button data-class="${key}" 
                                    class="p-4 rounded-lg border-2 transition-all card-hover ${
                                        gameState.selectedClass === key 
                                            ? 'border-purple-600 bg-purple-50' 
                                            : 'border-gray-300 hover:border-purple-400'
                                    }">
                                    <h3 class="font-bold text-lg mb-2">${sClass.name}</h3>
                                    <p class="text-sm text-gray-600">${sClass.description}</p>
                                </button>
                            `).join('')}
                        </div>
                    </div>

                    ${gameState.selectedProfile && gameState.selectedClass ? `
                        <div class="text-center">
                            <button id="startButton"
                                class="bg-indigo-600 text-white px-8 py-4 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors">
                                Commencer la Journ√©e
                            </button>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function renderDay() {
            const situation = gameState.currentSituation;
            return `
                <div class="max-w-6xl mx-auto p-4">
                    <div class="bg-white rounded-lg shadow-lg p-4 mb-4">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <h2 class="text-2xl font-bold text-gray-800">Jour ${gameState.day}</h2>
                                <p class="text-sm text-gray-600">${gameState.profile.name} - ${gameState.socialClass.name}</p>
                            </div>
                            <div class="flex gap-6">
                                <div class="text-center">
                                    <div class="text-3xl mb-1">‚òï</div>
                                    <div class="text-2xl font-bold text-amber-600">${gameState.spoons}</div>
                                    <div class="text-xs text-gray-600">Cuill√®res</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-3xl mb-1">‚ö°</div>
                                    <div class="text-2xl font-bold text-purple-600">${gameState.neuralResources}</div>
                                    <div class="text-xs text-gray-600">Ressources</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="w-full bg-gray-200 rounded-full h-4">
                            <div class="bg-gradient-to-r from-amber-400 to-amber-600 h-4 rounded-full transition-all"
                                style="width: ${(gameState.spoons / gameState.maxSpoons) * 100}%"></div>
                        </div>
                    </div>

                    ${gameState.message ? `
                        <div class="bg-blue-100 border-l-4 border-blue-600 p-4 mb-4 rounded fade-in">
                            <p class="text-blue-800 font-medium">${gameState.message}</p>
                        </div>
                    ` : ''}

                    ${situation ? `
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-4 fade-in">
                            <div class="flex items-center gap-4 mb-4">
                                <div class="text-5xl">${situation.icon}</div>
                                <div>
                                    <h3 class="text-2xl font-bold text-gray-800">${situation.title}</h3>
                                    <p class="text-gray-600">${situation.description}</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${situation.choices.map((choice, idx) => `
                                    <button data-choice="${idx}"
                                        class="p-4 bg-indigo-50 hover:bg-indigo-100 border-2 border-indigo-300 rounded-lg transition-all text-left card-hover">
                                        <div class="font-bold text-lg mb-2">${choice.text}</div>
                                        <div class="text-sm text-gray-600">
                                            Co√ªt: ${choice.cost} cuill√®res | Gain: ${choice.reward || 0} ressources
                                        </div>
                                        ${choice.requiresCard ? `
                                            <div class="text-xs text-purple-600 mt-1">
                                                N√©cessite: ${allCards[choice.requiresCard].name}
                                            </div>
                                        ` : ''}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">Vos Cartes</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            ${gameState.hand.map((card, idx) => `
                                <button data-card="${idx}"
                                    class="p-4 bg-gradient-to-br from-purple-50 to-pink-50 border-2 border-purple-300 rounded-lg hover:shadow-lg transition-all card-hover">
                                    <div class="font-bold text-sm mb-2">${card.name}</div>
                                    <div class="text-xs text-gray-600 mb-2">${card.effect}</div>
                                    <div class="text-xs font-bold text-purple-600">${card.cost} cuill√®res</div>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderRest() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-indigo-900 to-purple-900 p-8 flex items-center justify-center">
                    <div class="max-w-2xl bg-white rounded-lg shadow-2xl p-8 fade-in">
                        <div class="text-6xl text-center mb-4">üè†</div>
                        <h2 class="text-3xl font-bold text-center mb-4">Phase de Repos</h2>
                        <p class="text-center text-gray-600 mb-6">
                            La journ√©e est termin√©e. Prenez soin de vous pour demain.
                        </p>
                        
                        <div class="bg-indigo-50 rounded-lg p-6 mb-6">
                            <h3 class="text-xl font-bold mb-4">Ressources Neurales: ${gameState.neuralResources}</h3>
                            <p class="text-sm text-gray-600 mb-4">
                                Utilisez vos ressources pour am√©liorer vos capacit√©s.
                            </p>
                            
                            <div class="space-y-2">
                                <button id="upgradeSpoons"
                                    class="w-full p-3 bg-amber-100 hover:bg-amber-200 rounded-lg text-left transition-colors">
                                    <div class="font-bold">Am√©liorer le sommeil</div>
                                    <div class="text-sm text-gray-600">+1 cuill√®re max | Co√ªt: 3 ressources</div>
                                </button>
                            </div>
                        </div>

                        ${gameState.message ? `
                            <div class="bg-green-100 border-l-4 border-green-600 p-4 mb-4 rounded">
                                <p class="text-green-800">${gameState.message}</p>
                            </div>
                        ` : ''}

                        <button id="nextDay"
                            class="w-full bg-indigo-600 text-white py-4 rounded-lg text-xl font-bold hover:bg-indigo-700 transition-colors">
                            Jour Suivant
                        </button>
                    </div>
                </div>
            `;
        }

        function renderGameOver() {
            return `
                <div class="min-h-screen bg-gradient-to-br from-red-900 to-orange-900 p-8 flex items-center justify-center">
                    <div class="max-w-2xl bg-white rounded-lg shadow-2xl p-8 text-center fade-in">
                        <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                        <h2 class="text-3xl font-bold mb-4">Burnout</h2>
                        <p class="text-gray-600 mb-6">
                            Vous avez √©puis√© toutes vos cuill√®res. C'est la r√©alit√© quotidienne pour beaucoup de personnes neurodivergentes.
                        </p>
                        <div class="bg-gray-100 rounded-lg p-4 mb-6">
                            <p class="text-sm text-gray-700 mb-2">
                                Jours surv√©cus: <span class="font-bold">${gameState.day}</span>
                            </p>
                            <p class="text-sm text-gray-700">
                                Ressources accumul√©es: <span class="font-bold">${gameState.neuralResources}</span>
                            </p>
                        </div>
                        <button id="restart"
                            class="bg-indigo-600 text-white px-8 py-3 rounded-lg font-bold hover:bg-indigo-700 transition-colors">
                            Recommencer
                        </button>
                    </div>
                </div>
            `;
        }

        // Initialisation
        render();
    </script>
</body>
</html>
